r24460 | peter | 2011-11-02 15:38:52 +0000 (Wed, 02 Nov 2011) | 1 line

branch2011: import ttf2pk bug fix from trunk r24454

Index: Build/source/texk/ttf2pk/ChangeLog
===================================================================
--- Build/source/texk/ttf2pk/ChangeLog	(revision 24408)
+++ Build/source/texk/ttf2pk/ChangeLog	(revision 24460)
@@ -1,3 +1,8 @@
+2011-11-02  Peter Breitenlohner  <peb@mppmu.mpg.de>
+
+	* ttf2pk.c (main): Bug fix: mapfiles is malloc()ed, so do not
+	realloc() mapfiles+offset.
+
 2011-04-29  Peter Breitenlohner  <peb@mppmu.mpg.de>
 
 	* parse.c, ttfenc.c: Bug fix. Increase buffer size for increased
Index: Build/source/texk/ttf2pk/ttf2pk.c
===================================================================
--- Build/source/texk/ttf2pk/ttf2pk.c	(revision 24408)
+++ Build/source/texk/ttf2pk/ttf2pk.c	(revision 24460)
@@ -300,7 +300,8 @@
   long inenc_array[256];
   char *fontname;
   size_t fontname_len;
-  char *pk_filename, *tfm_filename, *enc_filename, *map_filename;
+  char *pk_filename, *tfm_filename, *enc_filename;
+  char *map_filename = NULL;
   char *real_ttfname, *real_map_filename;
   int dpi = 0, ptsize;
   Boolean hinting = True;
@@ -374,11 +375,14 @@
   p = mapfiles;
   while (*p)
   {
+    if (map_filename)
+      free(map_filename);
     map_filename = p;
     while (*p != '\n')
       p++;
     *p++ = '\0';
 
+    map_filename = newstring(map_filename);
     real_map_filename = TeX_search_map_file(&map_filename);
     if (!real_map_filename)
     {
